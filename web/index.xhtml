<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
<h:head>
    <title>Data analysis</title>
</h:head>
<h:body>
<h:outputStylesheet name="css/default.css"/>
<h:form enctype="multipart/form-data">
<p:messages id="messages" showDetail="true" autoUpdate="true" closable="true"/>
<p:fileUpload update="tt dataValues"

              fileUploadListener="#{bBean.handleFileUpload}" mode="advanced"

        />
<p:growl autoUpdate="true"/>

<p:panelMenu style="width:600px">
    <p:submenu label="Apache Statistics">
        <p:menuitem value="Descriptive statistics" actionListener="#{bBean.descriptiveStatistics}" ajax="false"/>
        <p:menuitem value="Frequency distributions" actionListener="#{bBean.frequencyDistributions}" ajax="false"/>
        <p:menuitem value="Simple Regression" onclick="PF('dlgSimple').show();" ajax="true"/>

        <p:submenu label="Multiple Regression">
            <p:menuitem value="OLS Multiple Linear Regression" onclick="PF('osldlg').show();" ajax="true"/>
            <p:menuitem value="GLS Multiple Linear Regression" onclick="PF('glsdlg').show();" ajax="true"/>
        </p:submenu>
        <p:menuitem value="Rank transformations" onclick="PF('rankDlg').show();" ajax="true"/>

        <p:submenu label="Covariance and correlation">
            <p:menuitem
                    value="Covariance, Kendalls's tau rank correlation coefficient, Spearman's rank correlation coefficient, Pearson's correlation"
                    style="white-space:pre-line;width:500px; height: 60px;" onclick="PF('covdlg').show();" ajax="true"/>
            <p:menuitem
                    value="Covariance matrix, Pearson's correlation matrix, Pearson's correlation significance and standard errors"
                    style="white-space:pre-line;width:500px;  height: 50px;" onclick="PF('covMatrixdlg').show();"
                    ajax="true"/>
        </p:submenu>
        <p:submenu label="Tests">
            <p:menuitem value="One-Sample T-Test" onclick="PF('ttest').show();" ajax="true"/>
            <p:menuitem value="Two-Simple T-Test" onclick="PF('twotest').show();" ajax="true"/>
            <p:menuitem value="Chi-square tests" onclick="PF('chiSquare').show();" ajax="true"/>
            <p:menuitem value="G tests" onclick="PF('gTests').show();" ajax="true"/>
            <p:menuitem value="One-Way ANOVA tests" onclick="PF('anova').show();" ajax="true"/>
            <p:menuitem value="Kolmogorov-Smirnov tests" onclick="PF('twotest').show();" ajax="true"/>
        </p:submenu>

        <p:menuitem value="Add variable" onclick="PF('addVar').show();" ajax="true"/>
        <p:menuitem value="Original data" actionListener="#{bBean.original}" ajax="true"/>


    </p:submenu>
</p:panelMenu>

<p:dialog global="true" header="Anova tests" widgetVar="anova" modal="true" minHeight="300"
          dynamic="true">

    <h:panelGrid columns="4">
        <h:outputLabel for="anovaData" value="Matrix:"/>
        <p:selectCheckboxMenu id="anovaData" value="#{bBean.testsData}" label="Classes"
                              filter="true" filterMatchMode="startsWith" panelStyle="width:250px">
            <f:selectItems value="#{bBean.columnTemplate}"/>
        </p:selectCheckboxMenu>

        <h:outputLabel for="anovaAlpha" value="significance level :"/>
        <p:inputText id="anovaAlpha" value="#{bBean.alpha}"/>

        <p:commandButton value="Submit" icon="ui-icon-check" actionListener="#{bBean.anova()}"
                         onclick="PF('anova').hide();" update="dataValues"/>
    </h:panelGrid>
</p:dialog>

<p:dialog global="true" header="T test" widgetVar="ttest" modal="true" minHeight="300"
          dynamic="true">

    <h:panelGrid columns="4">

        <h:outputLabel for="ttestData" value="X var:"/>
        <p:selectOneMenu id="ttestData" value="#{bBean.selectedX}" label="Independant vars"
                         filter="true" filterMatchMode="startsWith" panelStyle="width:250px">
            <f:selectItems value="#{bBean.columnTemplate}"/>
        </p:selectOneMenu>
        <h:outputLabel for="muValue" value="Mu value:"/>
        <p:inputText id="muValue" value="#{bBean.muValue}"/>
        <h:outputLabel for="alpha" value="Alpha value:"/>
        <p:inputText id="alpha" value="#{bBean.alpha}"/>

        <p:commandButton value="Submit" icon="ui-icon-check" actionListener="#{bBean.ttest()}"
                         onclick="PF('ttest').hide();" update="dataValues"/>
    </h:panelGrid>
</p:dialog>

<p:dialog global="true" header="T test" widgetVar="twotest" modal="true" minHeight="300"
          dynamic="true">

    <h:panelGrid columns="4">

        <h:outputLabel for="twotestDataX" value="X var:"/>
        <p:selectOneMenu id="twotestDataX" value="#{bBean.selectedX}" label="X var"
                         filter="true" filterMatchMode="startsWith" panelStyle="width:250px">
            <f:selectItems value="#{bBean.columnTemplate}"/>
        </p:selectOneMenu>
        <h:outputLabel for="twotestDataY" value="Y var:"/>
        <p:selectOneMenu id="twotestDataY" value="#{bBean.selectedY}" label="Y var"
                         filter="true" filterMatchMode="startsWith" panelStyle="width:250px">
            <f:selectItems value="#{bBean.columnTemplate}"/>
        </p:selectOneMenu>

        <h:outputLabel for="twoAlpha" value="Alpha value:"/>
        <p:inputText id="twoAlpha" value="#{bBean.alpha}"/>

        <p:commandButton value="Submit" icon="ui-icon-check" actionListener="#{bBean.twotest()}"
                         onclick="PF('twotest').hide();" update="dataValues"/>
    </h:panelGrid>
</p:dialog>

<p:dialog global="true" header="Chi-square tests" widgetVar="chiSquare" modal="true" minHeight="300"
          dynamic="true">

    <h:panelGrid columns="4">

        <h:outputLabel for="chiSquareDataX" value="X var:"/>
        <p:selectOneMenu id="chiSquareDataX" value="#{bBean.selectedX}" label="X var"
                         filter="true" filterMatchMode="startsWith" panelStyle="width:250px">
            <f:selectItems value="#{bBean.columnTemplate}"/>
        </p:selectOneMenu>
        <h:outputLabel for="chiSquareDataY" value="Y var:"/>
        <p:selectOneMenu id="chiSquareDataY" value="#{bBean.selectedY}" label="Y var"
                         filter="true" filterMatchMode="startsWith" panelStyle="width:250px">
            <f:selectItems value="#{bBean.columnTemplate}"/>
        </p:selectOneMenu>

        <h:outputLabel for="chiSquareAlpha" value="Alpha value:"/>
        <p:inputText id="chiSquareAlpha" value="#{bBean.alpha}"/>

        <p:commandButton value="Submit" icon="ui-icon-check" actionListener="#{bBean.chiSquare()}"
                         onclick="PF('chiSquare').hide();" update="dataValues"/>
    </h:panelGrid>
</p:dialog>


<p:dialog global="true" header="G tests" widgetVar="gTests" modal="true" minHeight="300"
          dynamic="true">

    <h:panelGrid columns="4">

        <h:outputLabel for="gDataX" value="X var:"/>
        <p:selectOneMenu id="gDataX" value="#{bBean.selectedX}" label="X var"
                         filter="true" filterMatchMode="startsWith" panelStyle="width:250px">
            <f:selectItems value="#{bBean.columnTemplate}"/>
        </p:selectOneMenu>
        <h:outputLabel for="gDataY" value="Y var:"/>
        <p:selectOneMenu id="gDataY" value="#{bBean.selectedY}" label="Y var"
                         filter="true" filterMatchMode="startsWith" panelStyle="width:250px">
            <f:selectItems value="#{bBean.columnTemplate}"/>
        </p:selectOneMenu>

        <h:outputLabel for="gAlpha" value="Alpha value:"/>
        <p:inputText id="gAlpha" value="#{bBean.alpha}"/>

        <p:commandButton value="Submit" icon="ui-icon-check" actionListener="#{bBean.gtest()}"
                         onclick="PF('gTests').hide();" update="dataValues"/>
    </h:panelGrid>
</p:dialog>

<p:dialog global="true" header="Create new parameter" widgetVar="addVar" modal="true" minHeight="300"
          dynamic="true">

    <h:panelGrid columns="4">

        <h:outputLabel for="firstVar" value="X var:"/>
        <p:selectOneMenu id="firstVar" value="#{bBean.selectedX}" label="Independant vars"
                         filter="true" filterMatchMode="startsWith" panelStyle="width:250px">
            <f:selectItems value="#{bBean.columnTemplate}"/>
        </p:selectOneMenu>

        <h:outputLabel for="secondVar" value="Y var:"/>
        <p:selectOneMenu id="secondVar" value="#{bBean.selectedY}" label="Y vars"
                         filter="true" filterMatchMode="startsWith" panelStyle="width:250px">
            <f:selectItems value="#{bBean.columnTemplate}"/>
        </p:selectOneMenu>

        <h:outputLabel for="operation" value="Type of operation:"/>
        <p:selectOneMenu id="operation" label="Operations" value="#{bBean.operation}"
                         filter="true" filterMatchMode="startsWith" panelStyle="width:250px">
            <f:selectItem itemLabel="multiply" itemValue="multiply"/>
            <f:selectItem itemLabel="extract" itemValue="extract"/>
            <f:selectItem itemLabel="divide" itemValue="divide"/>
            <f:selectItem itemLabel="add" itemValue="add"/>
        </p:selectOneMenu>
        <h:outputLabel for="varName" value="Name of variable:"/>
        <p:inputText id="varName" value="#{bBean.varName}"/>
        <p:commandButton value="Submit" icon="ui-icon-check" actionListener="#{bBean.addVariable()}"
                         onclick="PF('addVar').hide();" update="dataValues"/>
    </h:panelGrid>
</p:dialog>

<p:dialog global="true" header="Parameters of Covariance Matrixes" widgetVar="covMatrixdlg" modal="true" minHeight="300"
          dynamic="true">

    <h:panelGrid columns="4">
        <h:outputLabel for="dataCov" value="Matrix:"/>
        <p:selectCheckboxMenu id="dataCov" value="#{bBean.matrixDataCov}" label="Independant vars"
                              filter="true" filterMatchMode="startsWith" panelStyle="width:250px">
            <f:selectItems value="#{bBean.columnTemplate}"/>
        </p:selectCheckboxMenu>
        <p:commandButton value="Submit" icon="ui-icon-check" actionListener="#{bBean.covariance()}"
                         onclick="PF('covMatrixdlg').hide();" update="dataValues"/>
    </h:panelGrid>
</p:dialog>

<p:dialog global="true" header="Parameters of OLS Multiple Linear Regression" widgetVar="osldlg" modal="true"
          minHeight="300" dynamic="true">

    <h:panelGrid columns="4">
        <h:outputLabel for="depMenu" value="Dependant vars:"/>
        <p:selectOneMenu id="depMenu" value="#{bBean.selectedDepVars}" label="Dependant vars"
                         filter="true" filterMatchMode="startsWith" panelStyle="width:250px"
                         update="displayIndep displayDep">
            <f:selectItems value="#{bBean.columnTemplate}"/>
        </p:selectOneMenu>
        <h:outputLabel for="indepMenu" value="Inpendant var:"/>
        <p:selectCheckboxMenu id="indepMenu" value="#{bBean.selectedIndepVars}" label="Independant vars"
                              filter="true" filterMatchMode="startsWith" panelStyle="width:250px"
                              update="displayIndep displayDep">
            <f:selectItems value="#{bBean.columnTemplate}"/>
        </p:selectCheckboxMenu>
        <p:commandButton value="Submit" icon="ui-icon-check" actionListener="#{bBean.multipleRegressionOls}"
                         onclick="PF('osldlg').hide();" update="dataValues"/>
    </h:panelGrid>
</p:dialog>

<p:dialog global="true" header="Parameters of Rank Transform" widgetVar="rankDlg" modal="true" minHeight="400"
          dynamic="true">

    <h:panelGrid columns="4">
        <h:outputLabel for="tieMenu" value="Ties strategy:"/>
        <p:selectOneMenu id="tieMenu" value="#{bBean.tieStrategy}"
                         filter="true" filterMatchMode="startsWith" panelStyle="width:250px">
            <f:selectItem itemLabel="SEQUENTIAL" itemValue="SEQUENTIAL" noSelectionOption="true"/>
            <f:selectItem itemLabel="MINIMUM" itemValue="MINIMUM"/>
            <f:selectItem itemLabel="MAXIMUM" itemValue="MAXIMUM"/>
            <f:selectItem itemLabel="AVERAGE" itemValue="AVERAGE"/>
            <f:selectItem itemLabel="RANDOM" itemValue="RANDOM"/>
        </p:selectOneMenu>
        <h:outputLabel for="nanMenu" value="Nan strategy:"/>
        <p:selectOneMenu id="nanMenu" value="#{bBean.nanStrategy}"
                         filter="true" filterMatchMode="startsWith" panelStyle="width:250px">
            <f:selectItem itemLabel="MINIMAL" itemValue="MINIMAL" noSelectionOption="true"/>
            <f:selectItem itemLabel="MAXIMAL" itemValue="MAXIMAL"/>
            <f:selectItem itemLabel="REMOVED" itemValue="REMOVED"/>
            <f:selectItem itemLabel="FIXED" itemValue="FIXED"/>
            <f:selectItem itemLabel="FAILED" itemValue="FAILED"/>

        </p:selectOneMenu>
        <p:commandButton value="Submit" icon="ui-icon-check" actionListener="#{bBean.rankTransform()}"
                         onclick="PF('rankDlg').hide();" update="dataValues"/>
    </h:panelGrid>
</p:dialog>


<p:dialog global="true" header="Parameters of Covariance" widgetVar="covdlg" modal="true" minHeight="300"
          dynamic="true">

    <h:panelGrid columns="4">

        <h:outputLabel for="indepMenuCov" value="X var:"/>
        <p:selectOneMenu id="indepMenuCov" value="#{bBean.selectedX}" label="Independant vars"
                         filter="true" filterMatchMode="startsWith" panelStyle="width:250px">
            <f:selectItems value="#{bBean.columnTemplate}"/>
        </p:selectOneMenu>

        <h:outputLabel for="obsMenuCov" value="Y var:"/>
        <p:selectOneMenu id="obsMenuCov" value="#{bBean.selectedY}" label="Y vars"
                         filter="true" filterMatchMode="startsWith" panelStyle="width:250px">
            <f:selectItems value="#{bBean.columnTemplate}"/>
        </p:selectOneMenu>
        <p:commandButton value="Submit" icon="ui-icon-check" actionListener="#{bBean.pearsonsCorrelation()}"
                         onclick="PF('covdlg').hide();" update="dataValues"/>
    </h:panelGrid>
</p:dialog>

<p:dialog global="true" header="Parameters of GLS Multiple Linear Regression" widgetVar="glsdlg" modal="true"
          minHeight="300" dynamic="true">

    <h:panelGrid columns="4">
        <h:outputLabel for="depMenuGls" value="Dependant vars:"/>
        <p:selectOneMenu id="depMenuGls" value="#{bBean.selectedDepVars}" label="Dependant vars"
                         filter="true" filterMatchMode="startsWith" panelStyle="width:250px"
                         update="displayIndep displayDep">
            <f:selectItems value="#{bBean.columnTemplate}"/>
        </p:selectOneMenu>
        <h:outputLabel for="indepMenuGls" value="Inpendant var:"/>
        <p:selectCheckboxMenu id="indepMenuGls" value="#{bBean.selectedIndepVars}" label="Independant vars"
                              filter="true" filterMatchMode="startsWith" panelStyle="width:250px"
                              update="displayIndep displayDep">
            <f:selectItems value="#{bBean.columnTemplate}"/>
        </p:selectCheckboxMenu>

        <h:outputLabel for="obsMenuGls" value="Observation var:"/>
        <p:selectCheckboxMenu id="obsMenuGls" value="#{bBean.selectedObsVars}" label="Observation vars"
                              filter="true" filterMatchMode="startsWith" panelStyle="width:250px"
                              update="displayIndep displayDep">
            <f:selectItems value="#{bBean.columnTemplate}"/>
        </p:selectCheckboxMenu>
        <p:commandButton value="Submit" icon="ui-icon-check" actionListener="#{bBean.multipleRegressionGls}"
                         onclick="PF('dlg').hide();" update="dataValues"/>
    </h:panelGrid>
</p:dialog>


<p:dialog global="true" header="Parameters of simple regression" widgetVar="dlgSimple" modal="true" minHeight="300"
          dynamic="true">

    <h:panelGrid columns="4">
        <h:outputLabel for="indepMenuSimple" value="Independant vars:"/>
        <p:selectOneMenu id="indepMenuSimple" value="#{bBean.selectedInDep}" label="Independant vars"
                         filter="true" filterMatchMode="startsWith" panelStyle="width:250px"
                         update="displayIndep displayDep">
            <f:selectItems value="#{bBean.columnTemplate}"/>
        </p:selectOneMenu>
        <h:outputLabel for="depMenuSimple" value="Dependant vars:"/>
        <p:selectOneMenu id="depMenuSimple" value="#{bBean.selectedDep}" label="Dependant vars"
                         filter="true" filterMatchMode="startsWith" panelStyle="width:250px"
                         update="displayIndep displayDep">
            <f:selectItems value="#{bBean.columnTemplate}"/>
        </p:selectOneMenu>
        <p:commandButton value="Submit" icon="ui-icon-check" actionListener="#{bBean.simpleRegression}"
                         onclick="PF('dlgSimple').hide();" update="dataValues"/>
    </h:panelGrid>


</p:dialog>
<!--allowTypes="/(\.|\/)(xlsx)$/"-->
<p:growl id="tt" showDetail="true"/>


<p:dataTable id="dataValues" rowIndexVar="rowId" var="dataVal" value="#{bBean.dataValues}" widgetVar="dataValuesTable"
             scrollHeight="65%" resizableColumns="true" liveResize="true" scrollWidth="100%" scrollable="true"

             paginator="true" rows="20"
             paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown} {Exporters}"
             rowsPerPageTemplate="20,50,100">
    <f:facet name="header">
        Data Statistics

        <p:commandButton id="toggler" type="button" value="Columns" style="float:right" icon="ui-icon-calculator"/>
        <p:columnToggler datasource="dataValues" trigger="toggler"/>
    </f:facet>
    <f:facet name="{Exporters}">
        <h:commandLink>
            <p:graphicImage value="/resources/images/excel.png" width="24"/>
            <p:dataExporter type="xls" target="dataValues" fileName="statistics"/>
        </h:commandLink>

        <h:commandLink>
            <p:graphicImage value="/resources/images/csv.png" width="24"/>
            <p:dataExporter type="csv" target="dataValues" fileName="statistics"/>
        </h:commandLink>

        <h:commandLink>
            <p:graphicImage value="/resources/images/xml.png" width="24"/>
            <p:dataExporter type="xml" target="dataValues" fileName="statistics"/>
        </h:commandLink>
    </f:facet>
    <p:columns value="#{bBean.columns}" var="column" columnIndexVar="statistics"
               width="200">
        <f:facet name="header">
            <h:outputText value="#{column.header}"/>
        </f:facet>
        <h:outputText value="#{dataVal.getValues(rowId+1, column.index)}"/>
    </p:columns>


</p:dataTable>

<h2>Export Page Data Only</h2>
<h:commandLink>
    <p:graphicImage value="/resources/images/excel.png"/>
    <p:dataExporter type="xls" target="dataValues" fileName="statistics" pageOnly="true"/>
</h:commandLink>

<h:commandLink>
    <p:graphicImage value="/resources/images/csv.png"/>
    <p:dataExporter type="csv" target="dataValues" fileName="statistics" pageOnly="true"/>
</h:commandLink>

<h:commandLink>
    <p:graphicImage value="/resources/images/xml.png"/>
    <p:dataExporter type="xml" target="dataValues" fileName="statistics" pageOnly="true"/>
</h:commandLink>

</h:form>
</h:body>

</html>